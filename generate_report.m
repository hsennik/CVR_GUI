% GUI for clinician to fully process and analyze a subject who has
% undergone a CVR study 
% 
% File Name: generate_report.m
% 
% NOTES - HS - 16/08/05 - Initial Creation
% 
% AUTHOR - Hannah Sennik
% Created - 2016-08-05

clear all; % Clear all variables
close all; % Close all windows 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% INITIALIZING VARIABLES

addpath('/data/wayne/matlab/NIFTI'); % path to nii functions
directories.main = ('/data/projects/CVR/GUI_subjects'); % base directory where all CVR subjects are stored
cd(directories.main); % change to this directory
subject_names = dir(directories.main); % get subject names from main directory 
subj = ''; % initialize subj variable (struct)
subj.date = '160314'; % What is this - is it the same for all subjects?
directories.subject = ''; % initialize subject directory
directories.matlabdir = '/data/hannahsennik/MATLAB/CVR_GUI'; % specify the matlab directory that contains python and standard files 
directories.REDCapdir = 'REDCap_import_files'; % directory name for REDCap files 
directories.metadata = 'metadata'; % directory name for subject specific files to be inputted to pipeline
directories.textfilesdir = 'textfiles'; % directory name for output of textfiles generated by this program 
directories.timeseries = 'timeseries'; % directory name for output of .1D files generated by this program 
directories.flirtdir = 'flirt';

%  SUBJECT DATA
fileID = fopen([directories.matlabdir '/subject_name.txt'],'r'); % Subject name is pulled from this textfile (this is the subject that was just fully processed and analyzed)
subj.name = fscanf(fileID,'%s\n');
fclose(fileID);

%  Create the entire interface panel
report.f = figure('Name', ['Clinical Report: ' subj.name],...
                        'Visible','on',...
                        'Position',[50,800,1500,900],...
                        'numbertitle','off');
set(report.f, 'MenuBar', 'none'); % remove the menu bar 
set(report.f, 'ToolBar', 'none'); % remove the tool bar 

%  Subject name            
report.subject_name = uicontrol('Style','text',...
                        'units','normalized',...
                        'Position',[0,0.8,0.2,0.15],...
                        'String',['Subject name: ' subj.name]);

%  Create push button to save the field values to file
report.save = uicontrol('Style','pushbutton',...
                   'Visible','on',...
                   'String','SAVE REPORT',...
                   'Value',0,'Position',[750,150,200,60],...
                   'Enable','on',...
                   'callback',{@save_report,subj,directories});                    
                                      
                    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%      
%%% RESULTS %%%                    
%  Results
report.results = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0,0.75,0.2,0.15],...
                           'String','RESULTS');
                       
%  Session Success
report.success = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0,0.7,0.2,0.15],...
                           'String','Rate the adequacy of the study: ');
                       
%  Create dropdown for session success
report.success_dropdown = uicontrol('Style','popupmenu',...
                                    'Visible','on',...
                                    'Enable','on',...
                                    'String',{'','0','1','2','3'},...
                                    'Position',[255,745,40,25]);   
%  Session Success
report.success_scale = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0,0.65,0.2,0.15],...
                           'String','Scale');     

report.success_scale_0 = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0,0.62,0.2,0.15],...
                           'String','0 = poor, inadequate quality');                        

report.success_scale_1 = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0,0.59,0.2,0.15],...
                           'String','1 = some activation but not clinically useful');   
                       
report.success_scale_2 = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0,0.56,0.2,0.15],...
                           'String','2 = suboptimal but clinically useful activation');   
                       
report.success_scale_3 = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0,0.53,0.2,0.15],...
                           'String','3 = optimal diagnostic quality activation');                          
                                
%  Impression
report.impression = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0,0.48,0.2,0.15],...
                           'String','Impression: ');      
                       
%  Create dropdown for impression
report.impression_dropdown = uicontrol('Style','popupmenu',...
                                    'Visible','on',...
                                    'Enable','on',...
                                    'String',{'','Within normal limits','Abnormal'},...
                                    'Position',[70,510,150,10]);    

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%% IMPAIRED %%%                 

%  Impaired Reactivity 
report.impaired_reactivity = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0.29,0.75,0.2,0.15],...
                           'String','IMPAIRED REACTIVITY');    
                       
 %  Decreased Reactivity 
report.decreased_reactivity = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0.29,0.7,0.2,0.15],...
                           'String','Decreased Reactivity:');   
                       
%  Create dropdown for decreased reactivity
report.decreased_reactivity_dropdown = uicontrol('Style','popupmenu',...
                                    'Visible','on',...
                                    'Enable','on',...
                                    'String',{'','yes','no'},...
                                    'Position',[510,700,150,25]);   
                                
%  Impaired Laterality 
report.impaired_laterality = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0.26,0.6,0.05,0.15],...
                           'String','Laterality:');    
                       
%  Checkbox for left laterality
report.impaired_laterality_left = uicontrol('Style','checkbox',...
                                        'String','left',...
                                        'Value',0,'Position',[490 660 100 20]);  
                                    
%  Checkbox for right laterality
report.impaired_laterality_right = uicontrol('Style','checkbox',...
                                        'String','right',...
                                        'Value',0,'Position',[560 660 100 20]);  
                                   
%  Checkbox for right laterality
report.impaired_laterality_midline = uicontrol('Style','checkbox',...
                                        'String','midline',...
                                        'Value',0,'Position',[630 660 100 20]); 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                                     
%  Left side region
report.impaired_left_region = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0.335,0.65,0.1,0.05],...
                           'String','Left side');   
                       
report.impaired_left_enter_regions = uicontrol('Style','text',...
                                           'units','normalized',...
                                           'Position',[0.29,0.615,0.1,0.05],...
                                           'String','Enter regions:');
                                       
report.impaired_left_enter_regions_box = uicontrol('Style','edit',...
                                           'units','normalized',...
                                           'Position',[0.39,0.64,0.07,0.03],...
                                           'String','');           
                                       
report.impaired_left_steal = uicontrol('Style','text',...
                                       'units','normalized',...
                                       'Position',[0.29,0.575,0.1,0.05],...
                                       'String','Steal?');   
                                           
report.impaired_left_steal_dropdown = uicontrol('Style','popupmenu',...
                                    'Visible','on',...
                                    'Enable','on',...
                                    'String',{'','yes','no'},...
                                    'Position',[586,540,60,25]); 
                                
report.impaired_left_steal_location = uicontrol('Style','text',...
                                           'units','normalized',...
                                           'Position',[0.29,0.535,0.1,0.05],...
                                           'String','Steal Location:');
                                       
report.impaired_left_steal_regions_box = uicontrol('Style','edit',...
                                           'units','normalized',...
                                           'Position',[0.39,0.56,0.07,0.03],...
                                           'String',''); 
                                       
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
%  Right side region                                       
report.impaired_right_region = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0.335,0.48,0.1,0.05],...
                           'String','Right side');   
                       
report.impaired_right_enter_regions = uicontrol('Style','text',...
                                           'units','normalized',...
                                           'Position',[0.29,0.445,0.1,0.05],...
                                           'String','Enter regions:');
                                       
report.impaired_right_enter_regions_box = uicontrol('Style','edit',...
                                           'units','normalized',...
                                           'Position',[0.39,0.47,0.07,0.03],...
                                           'String','');           
                                       
report.impaired_right_steal = uicontrol('Style','text',...
                                       'units','normalized',...
                                       'Position',[0.29,0.405,0.1,0.05],...
                                       'String','Steal?');   
                                           
report.impaired_right_steal_dropdown = uicontrol('Style','popupmenu',...
                                    'Visible','on',...
                                    'Enable','on',...
                                    'String',{'','yes','no'},...
                                    'Position',[586,387,60,25]); 
                                
report.impaired_right_steal_location = uicontrol('Style','text',...
                                           'units','normalized',...
                                           'Position',[0.29,0.365,0.1,0.05],...
                                           'String','Steal Location:');
                                       
report.impaired_right_steal_regions_box = uicontrol('Style','edit',...
                                           'units','normalized',...
                                           'Position',[0.39,0.39,0.07,0.03],...
                                           'String','');                                           
                       
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                        
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%      
%%% POSITIVE %%%

%  Positive Reactivity
report.positive_reactivity = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0.58,0.75,0.2,0.15],...
                           'String','POSITIVE REACTIVITY');     
                       
%  Increased Reactivity 
report.increased_reactivity = uicontrol('Style','text',...
                               'units','normalized',...
                               'Position',[0.58,0.7,0.2,0.15],...
                               'String','Increased Reactivity:');  
                           
%  Create dropdown for increased reactivity
report.increased_reactivity_dropdown = uicontrol('Style','popupmenu',...
                                        'Visible','on',...
                                        'Enable','on',...
                                        'String',{'','yes','no'},...
                                        'Position',[950,700,150,25]);   
                                    
%  Positive Laterality 
report.positive_laterality = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0.56,0.6,0.05,0.15],...
                           'String','Laterality:');    
                       
%  Checkbox for left laterality
report.positive_laterality_left = uicontrol('Style','checkbox',...
                                        'String','left',...
                                        'Value',0,'Position',[930 660 100 20]);  
                                    
%  Checkbox for right laterality
report.positive_laterality_right = uicontrol('Style','checkbox',...
                                        'String','right',...
                                        'Value',0,'Position',[1000 660 100 20]);  
                                   
%  Checkbox for right laterality
report.positive_laterality_midline = uicontrol('Style','checkbox',...
                                        'String','midline',...
                                        'Value',0,'Position',[1070 660 100 20]);    

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                                     
%  Left side region
report.positive_left_region = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0.625,0.65,0.1,0.05],...
                           'String','Left side');   
                       
report.positive_left_enter_regions = uicontrol('Style','text',...
                                           'units','normalized',...
                                           'Position',[0.58,0.615,0.1,0.05],...
                                           'String','Enter regions:');
                                       
report.positive_left_enter_regions_box = uicontrol('Style','edit',...
                                           'units','normalized',...
                                           'Position',[0.68,0.64,0.07,0.03],...
                                           'String','');                                               
                                    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                                      
%  Right side region                                       
report.positive_right_region = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0.625,0.48,0.1,0.05],...
                           'String','Right side');   
                       
report.positive_right_enter_regions = uicontrol('Style','text',...
                                           'units','normalized',...
                                           'Position',[0.58,0.445,0.1,0.05],...
                                           'String','Enter regions:'); 

report.positive_right_enter_regions_box = uicontrol('Style','edit',...
                                       'units','normalized',...
                                       'Position',[0.68,0.47,0.07,0.03],...
                                       'String','');      

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
%%% INTERPRETATION/COMMENTS %%%

report.interpretation_summary = uicontrol('Style','text',...
                           'units','normalized',...
                           'Position',[0.05,0.28,0.2,0.05],...
                           'String','INTERPRETATION/COMMENTS');   
                       
report.interpretation_entry_box = uicontrol('Style','edit',...
                                       'units','normalized',...
                                       'Min',1,'Max',5,...
                                       'Position',[0.05,0.1,0.4,0.2],...
                                       'String','');    
                                   
guidata(report.f,report);                                                          
